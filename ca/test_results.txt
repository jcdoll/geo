============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.1, pluggy-1.6.0 -- /home/jcdoll/github/personal/geo/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/jcdoll/github/personal/geo
configfile: pytest.ini
plugins: cov-6.2.1
collecting ... collected 135 items

tests/unit/test_buoyancy_mechanics.py::test_buoyancy_mechanics_basics PASSED [  0%]
tests/unit/test_buoyancy_mechanics.py::test_density_based_forces PASSED  [  1%]
tests/unit/test_buoyancy_mechanics.py::test_fluid_displacement_conservation PASSED [  2%]
tests/unit/test_buoyancy_physics.py::test_density_differences PASSED     [  2%]
tests/unit/test_buoyancy_physics.py::test_pressure_field_setup PASSED    [  3%]
tests/unit/test_buoyancy_physics.py::test_force_calculation PASSED       [  4%]
tests/unit/test_buoyancy_physics.py::test_buoyancy_direction FAILED      [  5%]
tests/unit/test_fluid_behavior.py::test_fluid_conservation PASSED        [  5%]
tests/unit/test_fluid_behavior.py::test_fluid_blob_stability PASSED      [  6%]
tests/unit/test_fluid_behavior.py::test_fluid_falls_under_gravity FAILED [  7%]
tests/unit/test_material_cache_cleanup.py::TestMaterialCacheCleanup::test_cache_cleanup_after_delete FAILED [  8%]
tests/unit/test_material_cache_cleanup.py::TestMaterialCacheCleanup::test_cache_cleanup_during_phase_transitions PASSED [  8%]
tests/unit/test_material_cache_cleanup.py::TestMaterialCacheCleanup::test_cache_cleanup_with_material_swaps PASSED [  9%]
tests/unit/test_material_cache_cleanup.py::TestMaterialCacheCleanup::test_no_memory_leak_in_cache PASSED [ 10%]
tests/unit/test_material_properties.py::test_material_type_enum PASSED   [ 11%]
tests/unit/test_material_properties.py::test_material_properties PASSED  [ 11%]
tests/unit/test_material_properties.py::test_material_database PASSED    [ 12%]
tests/unit/test_material_properties.py::test_density_relationships PASSED [ 13%]
tests/unit/test_material_properties.py::test_thermal_properties PASSED   [ 14%]
tests/unit/test_material_properties.py::test_phase_transition_temperatures PASSED [ 14%]
tests/unit/test_motion_physics.py::TestRigidBodyDynamics::test_iceberg_floating SKIPPED [ 15%]
tests/unit/test_motion_physics.py::TestRigidBodyDynamics::test_rock_impact_on_ice SKIPPED [ 16%]
tests/unit/test_motion_physics.py::TestRigidBodyDynamics::test_rigid_body_rotation_prevention SKIPPED [ 17%]
tests/unit/test_poisson_solver.py::TestPoissonSolver::test_simple_divergence_calculation PASSED [ 17%]
tests/unit/test_poisson_solver.py::TestPoissonSolver::test_zero_divergence_field PASSED [ 18%]
tests/unit/test_poisson_solver.py::TestPoissonSolver::test_pressure_boundary_conditions PASSED [ 19%]
tests/unit/test_poisson_solver.py::TestPoissonSolver::test_jacobi_iteration_setup PASSED [ 20%]
tests/unit/test_poisson_solver.py::TestPoissonSolver::test_sor_relaxation_factor PASSED [ 20%]
tests/unit/test_poisson_solver.py::TestPoissonSolver::test_convergence_criteria PASSED [ 21%]
tests/unit/test_poisson_solver.py::TestVelocityProjection::test_pressure_gradient_calculation PASSED [ 22%]
tests/unit/test_poisson_solver.py::TestVelocityProjection::test_velocity_projection_step FAILED [ 22%]
tests/unit/test_poisson_solver.py::TestForceCalculation::test_gravity_force_calculation PASSED [ 23%]
tests/unit/test_poisson_solver.py::TestForceCalculation::test_buoyancy_force_calculation PASSED [ 24%]
tests/unit/test_pressure_density_gradient.py::TestPressureDensityGradient::test_pressure_gradient_at_interface FAILED [ 25%]
tests/unit/test_pressure_density_gradient.py::TestPressureDensityGradient::test_force_field_smooth_density PASSED [ 25%]
tests/unit/test_pressure_density_gradient.py::TestPressureDensityGradient::test_water_granite_column FAILED [ 26%]
tests/unit/test_pressure_gradient_term.py::test_pressure_gradient_term_added FAILED [ 27%]
tests/unit/test_pressure_gradient_term.py::test_self_gravity_includes_both_terms PASSED [ 28%]
tests/unit/test_pressure_gradient_term.py::test_force_calculation_consistency PASSED [ 28%]
tests/unit/test_pressure_solver.py::test_pressure_solver_basic PASSED    [ 29%]
tests/unit/test_pressure_solver.py::test_pressure_solver_zero_rhs PASSED [ 30%]
tests/unit/test_pressure_solver.py::test_pressure_solver_point_source PASSED [ 31%]
tests/unit/test_pressure_solver.py::test_pressure_solver_convergence PASSED [ 31%]
tests/unit/test_pressure_solver.py::test_variable_coefficient_solver PASSED [ 32%]
tests/unit/test_rigid_body_fall.py::test_rigid_body_fall FAILED          [ 33%]
tests/unit/test_rigid_body_fall.py::test_rigid_body_acceleration PASSED  [ 34%]
tests/unit/test_rigid_body_fall.py::test_multiple_rigid_bodies PASSED    [ 34%]
tests/unit/test_rigid_body_fluid_container.py::test_rock_donut_with_magma FAILED [ 35%]
tests/unit/test_rigid_body_fluid_container.py::test_ice_bowl_with_water PASSED [ 36%]
tests/unit/test_self_gravity.py::test_constant_density_poisson_residual PASSED [ 37%]
tests/unit/test_self_gravity.py::test_gravity_points_inward PASSED       [ 37%]
tests/unit/test_simple_container_movement.py::test_simple_container_fall PASSED [ 38%]
tests/unit/test_simple_container_movement.py::test_container_diagnostics FAILED [ 39%]
tests/unit/test_unified_kinematics.py::TestUnifiedKinematics::test_velocity_field_initialization PASSED [ 40%]
tests/unit/test_unified_kinematics.py::TestUnifiedKinematics::test_pressure_field_consistency PASSED [ 40%]
tests/unit/test_unified_kinematics.py::TestRisingBubbleScenario::test_bubble_setup PASSED [ 41%]
tests/unit/test_unified_kinematics.py::TestRisingBubbleScenario::test_buoyancy_force_calculation PASSED [ 42%]
tests/unit/test_unified_kinematics.py::TestRisingBubbleScenario::test_bubble_rise_tendency PASSED [ 42%]
tests/unit/test_unified_kinematics.py::TestDamBreakScenario::test_dam_setup PASSED [ 43%]
tests/unit/test_unified_kinematics.py::TestDamBreakScenario::test_pressure_gradient_across_dam PASSED [ 44%]
tests/unit/test_unified_kinematics.py::TestDamBreakScenario::test_dam_breach_setup PASSED [ 45%]
tests/unit/test_unified_kinematics.py::TestRockOnIceMeltCollapse::test_ice_support_setup PASSED [ 45%]
tests/unit/test_unified_kinematics.py::TestRockOnIceMeltCollapse::test_ice_melting_conditions PASSED [ 46%]
tests/unit/test_unified_kinematics.py::TestRockOnIceMeltCollapse::test_support_loss_scenario PASSED [ 47%]
tests/unit/test_unified_kinematics.py::TestHydrostaticEquilibrium::test_density_stratification FAILED [ 48%]
tests/unit/test_unified_kinematics.py::TestHydrostaticEquilibrium::test_pressure_gradient FAILED [ 48%]
tests/unit/test_unified_kinematics.py::TestHydrostaticEquilibrium::test_equilibrium_velocity PASSED [ 49%]
tests/unit/test_unified_kinematics.py::TestPoissonSolver::test_poisson_solver_convergence PASSED [ 50%]
tests/unit/test_unified_kinematics.py::TestPoissonSolver::test_boundary_conditions PASSED [ 51%]
tests/unit/test_unified_kinematics.py::TestPoissonSolver::test_pressure_units FAILED [ 51%]
tests/unit/test_unified_kinematics.py::TestPerformanceBenchmarks::test_100x100_grid_performance PASSED [ 52%]
tests/unit/test_unified_kinematics.py::TestPerformanceBenchmarks::test_memory_usage PASSED [ 53%]
tests/unit/test_velocity_projection.py::TestVelocityProjection::test_velocity_projection_reduces_divergence PASSED [ 54%]
tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_visualizer_initialization PASSED [ 54%]
tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_display_modes FAILED [ 55%]
tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_tool_switching PASSED [ 56%]
tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_sidebar_tabs PASSED [ 57%]
tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_simulation_speed_control PASSED [ 57%]
tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_status_bar_format FAILED [ 58%]
tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_button_creation PASSED [ 59%]
tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_time_series_data_handling FAILED [ 60%]
tests/scenarios/test_scenarios.py::test_water_conservation[40] PASSED    [ 60%]
tests/scenarios/test_scenarios.py::test_water_conservation[60] PASSED    [ 61%]
tests/scenarios/test_scenarios.py::test_magma_flow_and_cooling FAILED    [ 62%]
tests/scenarios/test_scenarios.py::test_water_conservation_stress PASSED [ 62%]
tests/scenarios/test_scenarios.py::test_water_blob_behavior[20-10] PASSED [ 63%]
tests/scenarios/test_scenarios.py::test_water_blob_behavior[10-20] PASSED [ 64%]
tests/scenarios/test_scenarios.py::test_water_blob_behavior[15-15] PASSED [ 65%]
tests/scenarios/test_scenarios.py::test_water_line_collapse FAILED       [ 65%]
tests/scenarios/test_scenarios.py::test_fluid_self_gravity FAILED        [ 66%]
tests/scenarios/test_scenarios.py::test_gravity_fall[MaterialType.BASALT] FAILED [ 67%]
tests/scenarios/test_scenarios.py::test_gravity_fall[MaterialType.WATER] FAILED [ 68%]
tests/scenarios/test_scenarios.py::test_gravity_fall[MaterialType.SAND] PASSED [ 68%]
tests/scenarios/test_scenarios.py::test_buoyancy[MaterialType.ICE-MaterialType.WATER-True] PASSED [ 69%]
tests/scenarios/test_scenarios.py::test_buoyancy[MaterialType.BASALT-MaterialType.WATER-False] FAILED [ 70%]
tests/scenarios/test_scenarios.py::test_buoyancy[MaterialType.PUMICE-MaterialType.WATER-True] PASSED [ 71%]
tests/scenarios/test_scenarios.py::test_buoyancy[MaterialType.GRANITE-MaterialType.MAGMA-True] PASSED [ 71%]
tests/scenarios/test_scenarios.py::test_hydrostatic_pressure FAILED      [ 72%]
tests/scenarios/test_scenarios.py::test_material_stability[MaterialType.GRANITE-vacuum-True] PASSED [ 73%]
tests/scenarios/test_scenarios.py::test_material_stability[MaterialType.ICE-vacuum-False] FAILED [ 74%]
tests/scenarios/test_scenarios.py::test_material_stability[MaterialType.GRANITE-magma-False] PASSED [ 74%]
tests/scenarios/test_scenarios.py::test_material_stability[MaterialType.LIMESTONE-water-True] PASSED [ 75%]
tests/scenarios/test_scenarios.py::test_rock_metamorphism FAILED         [ 76%]
tests/scenarios/test_scenarios.py::test_phase_transitions[MaterialType.ICE-melting] PASSED [ 77%]
tests/scenarios/test_scenarios.py::test_phase_transitions[MaterialType.WATER-freezing] FAILED [ 77%]
tests/scenarios/test_scenarios.py::test_phase_transitions[MaterialType.WATER-vaporization] PASSED [ 78%]
tests/scenarios/test_scenarios.py::test_rigid_body_with_fluid FAILED     [ 79%]
tests/scenarios/test_scenarios.py::test_rigid_body_displacement FAILED   [ 80%]
tests/scenarios/test_scenarios.py::test_rigid_body_rotation[L] FAILED    [ 80%]
tests/scenarios/test_scenarios.py::test_rigid_body_rotation[T] FAILED    [ 81%]
tests/scenarios/test_scenarios.py::test_complex_fluid_interaction SKIPPED [ 82%]
tests/scenarios/test_scenarios.py::test_material_phase_transitions PASSED [ 82%]
tests/scenarios/test_scenarios.py::test_large_scale_simulation PASSED    [ 83%]
tests/integration/test_integration.py::test_complete_simulation_workflow PASSED [ 84%]
tests/integration/test_integration.py::test_rock_transformation_workflow PASSED [ 85%]
tests/integration/test_integration.py::test_heat_and_pressure_interaction PASSED [ 85%]
tests/integration/test_integration.py::test_simulation_reversibility PASSED [ 86%]
tests/integration/test_integration.py::test_database_simulation_integration PASSED [ 87%]
tests/integration/test_integration.py::test_visualization_data_consistency PASSED [ 88%]
tests/integration/test_integration.py::test_large_simulation_stability PASSED [ 88%]
tests/integration/test_integration.py::test_extreme_conditions_handling PASSED [ 89%]
tests/integration/test_reset_simulation.py::test_simulate_reset_simulate_workflow PASSED [ 90%]
tests/integration/test_simulation_engine.py::test_simulation_initialization PASSED [ 91%]
tests/integration/test_simulation_engine.py::test_heat_injection PASSED  [ 91%]
tests/integration/test_simulation_engine.py::test_pressure_offset PASSED [ 92%]
tests/integration/test_simulation_engine.py::test_time_stepping PASSED   [ 93%]
tests/integration/test_simulation_engine.py::test_multiple_steps PASSED  [ 94%]
tests/integration/test_simulation_engine.py::test_basic_stats PASSED     [ 94%]
tests/integration/test_simulation_engine.py::test_color_mapping PASSED   [ 95%]
tests/integration/test_simulation_lifecycle.py::test_simulation_initialization PASSED [ 96%]
tests/integration/test_simulation_lifecycle.py::test_simulation_step_forward PASSED [ 97%]
tests/integration/test_simulation_lifecycle.py::test_simulation_reset FAILED [ 97%]
tests/integration/test_simulation_lifecycle.py::test_physics_integration FAILED [ 98%]
tests/integration/test_simulation_lifecycle.py::test_conservation_laws PASSED [ 99%]
tests/integration/test_space_integrity.py::test_space_cell_count_stable PASSED [100%]

=================================== FAILURES ===================================
___________________________ test_buoyancy_direction ____________________________
tests/unit/test_buoyancy_physics.py:138: in test_buoyancy_direction
    assert abs(ice_force_y) < gravity_force, "Buoyancy should reduce downward force"
E   AssertionError: Buoyancy should reduce downward force
E   assert np.float64(9276.794460685664) < np.float64(9200.0)
E    +  where np.float64(9276.794460685664) = abs(np.float64(9276.794460685664))
----------------------------- Captured stdout call -----------------------------
Buoyancy direction test:
  Ice density: 920.0 kg/m³
  Water density: 1000.0 kg/m³
  Expected buoyancy force: 800.0 N/m³ (upward)
  Gravity force on ice: 9200.0 N/m³ (downward)
  Actual net force on ice: 9276.8 N/m³
  Expected: Reduced downward force (partial buoyancy)
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270621969920:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270621969920:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270621969920:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270621969920:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270621969920:geo_game.py:165   Center: 0.0 MPa
________________________ test_fluid_falls_under_gravity ________________________
tests/unit/test_fluid_behavior.py:97: in test_fluid_falls_under_gravity
    assert final_y_center > initial_y_center + 2, f"Water didn't fall enough: {initial_y_center:.1f} -> {final_y_center:.1f}"
E   AssertionError: Water didn't fall enough: 5.5 -> 5.5
E   assert np.float64(5.5) > (np.float64(5.5) + 2)
___________ TestMaterialCacheCleanup.test_cache_cleanup_after_delete ___________
tests/unit/test_material_cache_cleanup.py:61: in test_cache_cleanup_after_delete
    assert not sim._properties_dirty, "Properties should be clean after step"
E   AssertionError: Properties should be clean after step
E   assert not True
E    +  where True = <geo_game.GeoGame object at 0x7b072543af60>._properties_dirty
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270620180320:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270620180320:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270620180320:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270620180320:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270620180320:geo_game.py:165   Center: 0.0 MPa
_____________ TestVelocityProjection.test_velocity_projection_step _____________
tests/unit/test_poisson_solver.py:294: in test_velocity_projection_step
    assert max_div_new <= max_div_old + 1e-10, (
E   AssertionError: Divergence should not increase: 0.04 -> 0.04000008000000001
E   assert np.float64(0.04000008000000001) <= (np.float64(0.04) + 1e-10)
---------------------------- Captured stderr setup -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log setup ------------------------------
INFO     GeoGame_135270620561280:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270620561280:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270620561280:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270620561280:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270620561280:geo_game.py:165   Center: 0.0 MPa
_______ TestPressureDensityGradient.test_pressure_gradient_at_interface ________
tests/unit/test_pressure_density_gradient.py:63: in test_pressure_gradient_at_interface
    assert abs(fy[y_air, mid_x] - expected_fy_air) < 1.0, \
E   AssertionError: Air force 3264.171915149344 != expected 12.0
E   assert np.float64(3252.171915149344) < 1.0
E    +  where np.float64(3252.171915149344) = abs((np.float64(3264.171915149344) - np.float64(12.0)))
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270620675056:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270620675056:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270620675056:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270620675056:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270620675056:geo_game.py:165   Center: 0.0 MPa
____________ TestPressureDensityGradient.test_water_granite_column _____________
tests/unit/test_pressure_density_gradient.py:156: in test_water_granite_column
    assert abs(fy[y_air, mid_x] - expected_fy_air) < 0.1, \
E   AssertionError: Air force 2242.1608937523474 != expected 11.772
E   assert np.float64(2230.3888937523475) < 0.1
E    +  where np.float64(2230.3888937523475) = abs((np.float64(2242.1608937523474) - np.float64(11.772)))
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270620948112:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270620948112:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270620948112:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270620948112:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270620948112:geo_game.py:165   Center: 0.0 MPa
______________________ test_pressure_gradient_term_added _______________________
tests/unit/test_pressure_gradient_term.py:46: in test_pressure_gradient_term_added
    assert 8 <= max_variation_y <= 11, \
E   AssertionError: Maximum pressure variation at y=13, expected near y=10
E   assert np.int64(13) <= 11
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270620953968:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270620953968:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270620953968:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270620953968:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270620953968:geo_game.py:165   Center: 0.0 MPa
_____________________________ test_rigid_body_fall _____________________________
tests/unit/test_rigid_body_fall.py:49: in test_rigid_body_fall
    print(f"Granite-granite binding: {sim.fluid_dynamics.solid_binding_force:.2e} N")
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'FluidDynamics' object has no attribute 'solid_binding_force'
----------------------------- Captured stdout call -----------------------------

Expected force calculations:
Granite density: 2650 kg/m³
Gravity: 10 m/s²
Expected force density: 26500 N/m³
Cell volume: 30000000.0 m³
Expected force per cell: 7.95e+11 N
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.2 MPa
  Mean: 0.0 MPa
  Center: 0.2 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270620912560:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270620912560:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270620912560:geo_game.py:163   Max: 0.2 MPa
INFO     GeoGame_135270620912560:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270620912560:geo_game.py:165   Center: 0.2 MPa
__________________________ test_rock_donut_with_magma __________________________
tests/unit/test_rigid_body_fluid_container.py:102: in test_rock_donut_with_magma
    assert final_granite_count >= initial_granite_count * 0.7, \
E   AssertionError: Too much granite lost: 40 -> 0
E   assert np.int64(0) >= (np.int64(40) * 0.7)
----------------------------- Captured stdout call -----------------------------

Initial state:
Granite cells: 40
Magma cells: 9
Magma temperature: 1500.0K
Step 1: Granite=0, Magma=9, Magma temp=1500.0K
Step 2: Granite=0, Magma=9, Magma temp=1500.0K
Step 3: Granite=0, Magma=9, Magma temp=1500.0K
Step 4: Granite=0, Magma=9, Magma temp=1500.0K
Step 5: Granite=0, Magma=9, Magma temp=1500.0K
Step 6: Granite=0, Magma=9, Magma temp=1500.0K
Step 7: Granite=0, Magma=9, Magma temp=1500.0K
Step 8: Granite=0, Magma=9, Magma temp=1500.0K
Step 9: Granite=0, Magma=9, Magma temp=1500.0K
Step 10: Granite=0, Magma=9, Magma temp=1500.0K
Step 11: Granite=0, Magma=9, Magma temp=1500.0K
Step 12: Granite=0, Magma=9, Magma temp=1500.0K
Step 13: Granite=0, Magma=9, Magma temp=1500.0K
Step 14: Granite=0, Magma=9, Magma temp=1500.0K
Step 15: Granite=0, Magma=9, Magma temp=1500.0K
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.5 MPa
  Mean: 0.1 MPa
  Center: 0.5 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270618992512:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270618992512:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270618992512:geo_game.py:163   Max: 0.5 MPa
INFO     GeoGame_135270618992512:geo_game.py:164   Mean: 0.1 MPa
INFO     GeoGame_135270618992512:geo_game.py:165   Center: 0.5 MPa
__________________________ test_container_diagnostics __________________________
tests/unit/test_simple_container_movement.py:106: in test_container_diagnostics
    labels, num_groups = sim.fluid_dynamics.identify_rigid_groups()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'FluidDynamics' object has no attribute 'identify_rigid_groups'
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270619003024:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270619003024:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270619003024:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270619003024:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270619003024:geo_game.py:165   Center: 0.0 MPa
____________ TestHydrostaticEquilibrium.test_density_stratification ____________
tests/unit/test_unified_kinematics.py:392: in test_density_stratification
    assert avg_water_distance < avg_air_distance, "Water should be closer to center than air"
E   AssertionError: Water should be closer to center than air
E   assert np.float64(8.33197464919239) < np.float64(6.371629035605048)
---------------------------- Captured stderr setup -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log setup ------------------------------
INFO     GeoGame_135270620909488:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270620909488:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270620909488:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270620909488:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270620909488:geo_game.py:165   Center: 0.0 MPa
______________ TestHydrostaticEquilibrium.test_pressure_gradient _______________
tests/unit/test_unified_kinematics.py:425: in test_pressure_gradient
    assert avg_inner_pressure >= avg_outer_pressure, \
E   AssertionError: Inner pressure 64.43479057715429 should be >= outer pressure 1371.5613615704774
E   assert np.float64(64.43479057715429) >= np.float64(1371.5613615704774)
---------------------------- Captured stderr setup -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log setup ------------------------------
INFO     GeoGame_135270620554656:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270620554656:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270620554656:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270620554656:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270620554656:geo_game.py:165   Center: 0.0 MPa
____________________ TestPoissonSolver.test_pressure_units _____________________
tests/unit/test_unified_kinematics.py:474: in test_pressure_units
    assert np.all(pressures < 1000), "Pressure should be reasonable (< 1000 MPa)"
E   AssertionError: Pressure should be reasonable (< 1000 MPa)
E   assert np.False_
E    +  where np.False_ = <function all at 0x7b07cdff5770>(array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       2.47097240e+02, 4.58920885e+02, 6.04189357e+02, 3.22557893e+02,\n       9.11881756e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 6.14553406e+02,\n       1.15417418e+03, 1.49439535e+03, 1.50864496e+03, 1.28488290e+03,\n       8.50063619e+02, 2.69091803e+02, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 2.47097240e+02,\n       1.15417418e+03, 1.89759225e+03, 2.38931879e+03, 2.38405345e+03,\n       2.13972352e+03, 1.47407330e+03, 7.57472597e+02, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       4.58920885e+02, 1.49439535e+03, 2.38931879e+03, 3.36910660e+03,\n       6.19012681e+03, 3.00139563e+03, 1.93520162e+03, 1.01034971e+03,\n       1.05849050e+02, 0.00000000e+00, 0.00000000e+00, 0.00000...00e+00, 0.00000000e+00, 0.00000000e+00,\n       3.22557893e+02, 1.28488290e+03, 2.13972352e+03, 3.00139563e+03,\n       5.82762271e+03, 2.67753392e+03, 1.74146666e+03, 8.71421912e+02,\n       1.50667142e+01, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 9.11881756e+00, 8.50063619e+02, 1.47407330e+03,\n       1.93520162e+03, 1.84015649e+03, 1.74146666e+03, 1.15976796e+03,\n       5.48186516e+02, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 2.69091803e+02,\n       7.57472597e+02, 1.01034971e+03, 1.06019206e+03, 8.71421912e+02,\n       5.48186516e+02, 3.88623076e+01, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 1.05849050e+02, 2.48578945e+02, 1.50667142e+01,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,\n       0.00000000e+00]) < 1000)
E    +    where <function all at 0x7b07cdff5770> = np.all
---------------------------- Captured stderr setup -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log setup ------------------------------
INFO     GeoGame_135270620428432:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270620428432:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270620428432:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270620428432:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270620428432:geo_game.py:165   Center: 0.0 MPa
________________ TestVisualizerFunctionality.test_display_modes ________________
tests/unit/test_visualizer_functionality.py:70: in test_display_modes
    assert colors.shape == (16, 16, 3)
E   AssertionError: assert (128, 128, 3) == (16, 16, 3)
E     
E     At index 0 diff: 128 != 16
E     
E     Full diff:
E       (
E     -     16,
E     ?      ^...
E     
E     ...Full output truncated (8 lines hidden), use '-vv' to show
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 4.4 MPa
  Mean: 0.6 MPa
  Center: 4.3 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270619782688:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270619782688:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270619782688:geo_game.py:163   Max: 4.4 MPa
INFO     GeoGame_135270619782688:geo_game.py:164   Mean: 0.6 MPa
INFO     GeoGame_135270619782688:geo_game.py:165   Center: 4.3 MPa
______________ TestVisualizerFunctionality.test_status_bar_format ______________
tests/unit/test_visualizer_functionality.py:156: in test_status_bar_format
    assert rendered_text is not None
E   assert None is not None
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 4.4 MPa
  Mean: 0.6 MPa
  Center: 4.3 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270619721520:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270619721520:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270619721520:geo_game.py:163   Max: 4.4 MPa
INFO     GeoGame_135270619721520:geo_game.py:164   Mean: 0.6 MPa
INFO     GeoGame_135270619721520:geo_game.py:165   Center: 4.3 MPa
__________ TestVisualizerFunctionality.test_time_series_data_handling __________
tests/unit/test_visualizer_functionality.py:222: in test_time_series_data_handling
    viz._draw_graphs_tab(10, 10)
visualizer.py:1356: in _draw_graphs_tab
    fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(5, 6))
    ^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 0)
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 4.4 MPa
  Mean: 0.6 MPa
  Center: 4.3 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270618368624:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270618368624:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270618368624:geo_game.py:163   Max: 4.4 MPa
INFO     GeoGame_135270618368624:geo_game.py:164   Mean: 0.6 MPa
INFO     GeoGame_135270618368624:geo_game.py:165   Center: 4.3 MPa
_________________________ test_magma_flow_and_cooling __________________________
tests/scenarios/test_scenarios.py:78: in test_magma_flow_and_cooling
    assert result['success'], f"Magma flow test failed: {result['message']}"
E   AssertionError: Magma flow test failed: Magma: 18 cells, spread: 1.7, temp: 1500K
E   assert np.False_
----------------------------- Captured stdout call -----------------------------

Running scenario: magma_flow_volcano_8
Description: Tests magma flow from volcano and cooling to basalt
Parameters: {'grid_size': 60, 'timeout': 30}
------------------------------------------------------------
Initial state: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 10: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 20: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 30: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 40: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 50: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 60: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 70: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 80: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 90: Magma: 18 cells, spread: 1.7, temp: 1500K
Step 100: Magma: 18 cells, spread: 1.7, temp: 1500K

Final results:
  Steps run: 100
  Success: False
  Magma: 18 cells, spread: 1.7, temp: 1500K

Metrics:
  magma_count: 18
  basalt_count: 841
  magma_spread: 1.707825127659933
  avg_magma_temp: 1499.7960738968168
  lowest_magma_y: 41
___________________________ test_water_line_collapse ___________________________
tests/scenarios/test_scenarios.py:127: in test_water_line_collapse
    assert result['success'], f"Water line collapse failed: {result['message']}"
E   AssertionError: Water line collapse failed: Water: 3x30 (was 3x30)
E   assert np.False_
----------------------------- Captured stdout call -----------------------------

Running scenario: water_line_collapse_h30
Description: Tests collapse of 30-cell tall water column
Parameters: {'grid_size': 60, 'timeout': 30}
------------------------------------------------------------
Initial state: Water: 3x30 (was 3x30)
Step 10: Water: 3x30 (was 3x30)
Step 20: Water: 3x30 (was 3x30)
Step 30: Water: 3x30 (was 3x30)
Step 40: Water: 3x30 (was 3x30)
Step 50: Water: 3x30 (was 3x30)
Step 60: Water: 3x30 (was 3x30)
Step 70: Water: 3x30 (was 3x30)
Step 80: Water: 3x30 (was 3x30)
Step 90: Water: 3x30 (was 3x30)
Step 100: Water: 3x30 (was 3x30)

Final results:
  Steps run: 100
  Success: False
  Water: 3x30 (was 3x30)

Metrics:
  water_count: 90
  water_width: 3
  water_height: 30
  width_ratio: 1.0
  height_ratio: 1.0
___________________________ test_fluid_self_gravity ____________________________
tests/scenarios/test_scenarios.py:146: in test_fluid_self_gravity
    assert result['success'], f"Fluid gravity test failed: {result['message']}"
E   AssertionError: Fluid gravity test failed: Fluid distance: 27.1 (was 25.0)
E   assert np.False_
----------------------------- Captured stdout call -----------------------------

Running scenario: fluid_gravity_water
Description: Tests WATER behavior near gravitational body
Parameters: {'grid_size': 80, 'timeout': 40}
------------------------------------------------------------
Initial state: Fluid distance: 25.0 (was 25.0)
Step 10: Fluid distance: 24.9 (was 25.0)
Step 20: Fluid distance: 24.8 (was 25.0)
Step 30: Fluid distance: 24.8 (was 25.0)
Step 40: Fluid distance: 24.8 (was 25.0)
Step 50: Fluid distance: 24.8 (was 25.0)
Step 60: Fluid distance: 24.8 (was 25.0)
Step 70: Fluid distance: 24.8 (was 25.0)
Step 80: Fluid distance: 26.5 (was 25.0)
Step 90: Fluid distance: 27.1 (was 25.0)
Step 100: Fluid distance: 27.1 (was 25.0)
Step 110: Fluid distance: 27.1 (was 25.0)
Step 120: Fluid distance: 27.1 (was 25.0)
Step 130: Fluid distance: 27.1 (was 25.0)
Step 140: Fluid distance: 27.1 (was 25.0)
Step 150: Fluid distance: 27.1 (was 25.0)

Final results:
  Steps run: 150
  Success: False
  Fluid distance: 27.1 (was 25.0)

Metrics:
  fluid_count: 13
  distance_to_planet: 27.083915181126635
  initial_distance: 24.9680796217891
  moved_closer: False
  on_surface: False
____________________ test_gravity_fall[MaterialType.BASALT] ____________________
tests/scenarios/test_scenarios.py:172: in test_gravity_fall
    assert result['success'], f"Gravity test failed for {material.name}: {result['message']}"
E   AssertionError: Gravity test failed for BASALT: Object at y=9.5 (fell 0.0 units)
E   assert np.False_
----------------------------- Captured stdout call -----------------------------

Running scenario: gravity_fall_basalt
Description: Tests BASALT falling under gravity
Parameters: {'grid_size': 60, 'timeout': 20}
------------------------------------------------------------
Initial state: Object at y=9.5 (fell 0.0 units)
Step 10: Object at y=9.5 (fell 0.0 units)
Step 20: Object at y=9.5 (fell 0.0 units)
Step 30: Object at y=9.5 (fell 0.0 units)
Step 40: Object at y=9.5 (fell 0.0 units)
Step 50: Object at y=9.5 (fell 0.0 units)
Step 60: Object at y=9.5 (fell 0.0 units)
Step 70: Object at y=9.5 (fell 0.0 units)
Step 80: Object at y=9.5 (fell 0.0 units)
Step 90: Object at y=9.5 (fell 0.0 units)
Step 100: Object at y=9.5 (fell 0.0 units)
Step 110: Object at y=9.5 (fell 0.0 units)
Step 120: Object at y=9.5 (fell 0.0 units)
Step 130: Object at y=9.5 (fell 0.0 units)
Step 140: Object at y=9.5 (fell 0.0 units)
Step 150: Object at y=9.5 (fell 0.0 units)
Step 160: Object at y=9.5 (fell 0.0 units)
Step 170: Object at y=9.5 (fell 0.0 units)
Step 180: Object at y=9.5 (fell 0.0 units)
Step 190: Object at y=9.5 (fell 0.0 units)
Step 200: Object at y=9.5 (fell 0.0 units)
Step 210: Object at y=9.5 (fell 0.0 units)
Step 220: Object at y=9.5 (fell 0.0 units)
Step 230: Object at y=9.5 (fell 0.0 units)
Step 240: Object at y=9.5 (fell 0.0 units)
Step 250: Object at y=9.5 (fell 0.0 units)
Step 260: Object at y=9.5 (fell 0.0 units)
Step 270: Object at y=9.5 (fell 0.0 units)
Step 280: Object at y=9.5 (fell 0.0 units)
Step 290: Object at y=9.5 (fell 0.0 units)
Step 300: Object at y=9.5 (fell 0.0 units)

Final results:
  Steps run: 300
  Success: False
  Object at y=9.5 (fell 0.0 units)

Metrics:
  center_y: 9.5
  fall_distance: 0.0
  object_count: 16
  intact: True
____________________ test_gravity_fall[MaterialType.WATER] _____________________
tests/scenarios/test_scenarios.py:172: in test_gravity_fall
    assert result['success'], f"Gravity test failed for {material.name}: {result['message']}"
E   AssertionError: Gravity test failed for WATER: Object at y=9.5 (fell 0.0 units)
E   assert np.False_
----------------------------- Captured stdout call -----------------------------

Running scenario: gravity_fall_water
Description: Tests WATER falling under gravity
Parameters: {'grid_size': 60, 'timeout': 20}
------------------------------------------------------------
Initial state: Object at y=9.5 (fell 0.0 units)
Step 10: Object at y=9.5 (fell 0.0 units)
Step 20: Object at y=9.5 (fell 0.0 units)
Step 30: Object at y=9.5 (fell 0.0 units)
Step 40: Object at y=9.5 (fell 0.0 units)
Step 50: Object at y=9.5 (fell 0.0 units)
Step 60: Object at y=9.5 (fell 0.0 units)
Step 70: Object at y=9.5 (fell 0.0 units)
Step 80: Object at y=9.5 (fell 0.0 units)
Step 90: Object at y=9.5 (fell 0.0 units)
Step 100: Object at y=9.5 (fell 0.0 units)
Step 110: Object at y=9.5 (fell 0.0 units)
Step 120: Object at y=9.5 (fell 0.0 units)
Step 130: Object at y=9.5 (fell 0.0 units)
Step 140: Object at y=9.5 (fell 0.0 units)
Step 150: Object at y=9.5 (fell 0.0 units)
Step 160: Object at y=9.5 (fell 0.0 units)
Step 170: Object at y=9.5 (fell 0.0 units)
Step 180: Object at y=9.5 (fell 0.0 units)
Step 190: Object at y=9.5 (fell 0.0 units)
Step 200: Object at y=9.5 (fell 0.0 units)
Step 210: Object at y=9.5 (fell 0.0 units)
Step 220: Object at y=9.5 (fell 0.0 units)
Step 230: Object at y=9.5 (fell 0.0 units)
Step 240: Object at y=9.5 (fell 0.0 units)
Step 250: Object at y=9.5 (fell 0.0 units)
Step 260: Object at y=9.5 (fell 0.0 units)
Step 270: Object at y=9.5 (fell 0.0 units)
Step 280: Object at y=9.5 (fell 0.0 units)
Step 290: Object at y=9.5 (fell 0.0 units)
Step 300: Object at y=9.5 (fell 0.0 units)

Final results:
  Steps run: 300
  Success: False
  Object at y=9.5 (fell 0.0 units)

Metrics:
  center_y: 9.5
  fall_distance: 0.0
  object_count: 16
  intact: True
_________ test_buoyancy[MaterialType.BASALT-MaterialType.WATER-False] __________
tests/scenarios/test_scenarios.py:204: in test_buoyancy
    assert depth > 10, f"{object_type.name} should sink in {fluid_type.name} but stayed at depth {depth}"
E   AssertionError: BASALT should sink in WATER but stayed at depth 4.533333333333331
E   assert np.float64(4.533333333333331) > 10
----------------------------- Captured stdout call -----------------------------

Running scenario: buoyancy_basalt_in_water
Description: Tests buoyancy of BASALT in WATER
Parameters: {'grid_size': 60, 'timeout': 30}
------------------------------------------------------------
Initial state: Object at depth 4.5 (should sink)
Step 10: Object at depth 4.5 (should sink)
Step 20: Object at depth 4.5 (should sink)
Step 30: Object at depth 4.5 (should sink)
Step 40: Object at depth 4.5 (should sink)
Step 50: Object at depth 4.5 (should sink)
Step 60: Object at depth 4.5 (should sink)
Step 70: Object at depth 4.5 (should sink)
Step 80: Object at depth 4.5 (should sink)
Step 90: Object at depth 4.5 (should sink)
Step 100: Object at depth 4.5 (should sink)

Final results:
  Steps run: 100
  Success: False
  Object at depth 4.5 (should sink)

Metrics:
  center_y: 34.53333333333333
  fluid_surface_y: 30
  depth_in_fluid: 4.533333333333331
  obj_density: 3000
  fluid_density: 1000
  should_float: False
__________________________ test_hydrostatic_pressure ___________________________
tests/scenarios/test_scenarios.py:219: in test_hydrostatic_pressure
    assert result['success'], f"Hydrostatic pressure test failed: {result['message']}"
E   AssertionError: Hydrostatic pressure test failed: Pressure gradient: 792 Pa/m (error: 91.9%)
E   assert np.False_
----------------------------- Captured stdout call -----------------------------

Running scenario: hydrostatic_pressure_depth_40
Description: Tests pressure increases with depth in static fluid
Parameters: {'grid_size': 60, 'timeout': 20}
------------------------------------------------------------
Initial state: Pressure gradient: 0 Pa/m (error: 100.0%)
Step 10: Pressure gradient: 792 Pa/m (error: 91.9%)
Step 20: Pressure gradient: 792 Pa/m (error: 91.9%)

Final results:
  Steps run: 20
  Success: False
  Pressure gradient: 792 Pa/m (error: 91.9%)

Metrics:
  num_samples: 4
  pressure_increasing: True
  gradient: 792.2079183177458
  gradient_error_pct: 91.92448605180687
____________ test_material_stability[MaterialType.ICE-vacuum-False] ____________
tests/scenarios/test_scenarios.py:254: in test_material_stability
    assert preservation < 50, f"{material.name} too stable in {environment}: {preservation:.1f}%"
E   AssertionError: ICE too stable in vacuum: 100.0%
E   assert np.float64(100.0) < 50
----------------------------- Captured stdout call -----------------------------

Running scenario: material_stability_ice_in_vacuum
Description: Tests ICE stability in vacuum
Parameters: {'grid_size': 40, 'timeout': 30}
------------------------------------------------------------
Initial state: ICE: 100.0% preserved, T=250K
Step 1: ICE: 100.0% preserved, T=250K

Success criteria met at step 1!

Final results:
  Steps run: 1
  Success: True
  ICE: 100.0% preserved, T=250K

Metrics:
  material_count: 100
  preservation_pct: 100.0
  avg_temperature: 249.62002014160157
  num_material_types: 2
____________________________ test_rock_metamorphism ____________________________
tests/scenarios/test_scenarios.py:268: in test_rock_metamorphism
    assert result['success'], f"Metamorphism test failed: {result['message']}"
E   AssertionError: Metamorphism test failed: Transformed 13.4%, T=954K, P=0Pa
E   assert np.False_
----------------------------- Captured stdout call -----------------------------

Running scenario: metamorphism_shale_both
Description: Tests metamorphism of SHALE under both
Parameters: {'grid_size': 60, 'timeout': 40}
------------------------------------------------------------
Initial state: Transformed 0.0%, T=800K, P=0Pa
Step 10: Transformed 0.0%, T=793K, P=0Pa
Step 20: Transformed 0.0%, T=799K, P=0Pa
Step 30: Transformed 0.0%, T=807K, P=0Pa
Step 40: Transformed 0.0%, T=817K, P=0Pa
Step 50: Transformed 0.0%, T=828K, P=0Pa
Step 60: Transformed 1.7%, T=840K, P=0Pa
Step 70: Transformed 4.1%, T=852K, P=0Pa
Step 80: Transformed 4.7%, T=864K, P=0Pa
Step 90: Transformed 8.7%, T=877K, P=0Pa
Step 100: Transformed 11.6%, T=890K, P=0Pa
Step 110: Transformed 11.6%, T=903K, P=0Pa
Step 120: Transformed 12.8%, T=916K, P=0Pa
Step 130: Transformed 12.9%, T=929K, P=0Pa
Step 140: Transformed 13.1%, T=941K, P=0Pa
Step 150: Transformed 13.4%, T=954K, P=0Pa

Final results:
  Steps run: 150
  Success: False
  Transformed 13.4%, T=954K, P=0Pa

Metrics:
  source_count: 1039
  transform_pct: 13.416666666666666
  num_products: 0
  avg_temperature: 954.3868773905436
  avg_pressure: 0.0
_____________ test_phase_transitions[MaterialType.WATER-freezing] ______________
tests/scenarios/test_scenarios.py:290: in test_phase_transitions
    assert result['success'], f"{transition} of {material.name} failed: {result['message']}"
E   AssertionError: freezing of WATER failed: Conversion: 0.0%, WATER→ICE
E   assert np.False_
----------------------------- Captured stdout call -----------------------------

Running scenario: phase_transition_water_freezing
Description: Tests freezing of WATER
Parameters: {'grid_size': 40, 'timeout': 30}
------------------------------------------------------------
Initial state: Conversion: 0.0%, WATER→ICE
Step 10: Conversion: 0.0%, WATER→ICE
Step 20: Conversion: 0.0%, WATER→ICE
Step 30: Conversion: 0.0%, WATER→ICE
Step 40: Conversion: 0.0%, WATER→ICE
Step 50: Conversion: 0.0%, WATER→ICE
Step 60: Conversion: 0.0%, WATER→ICE
Step 70: Conversion: 0.0%, WATER→ICE
Step 80: Conversion: 0.0%, WATER→ICE
Step 90: Conversion: 0.0%, WATER→ICE
Step 100: Conversion: 0.0%, WATER→ICE

Final results:
  Steps run: 100
  Success: False
  Conversion: 0.0%, WATER→ICE

Metrics:
  original_count: 317
  product_count: 0
  conversion_pct: 0.0
  avg_original_temp: 279.9998152495398
  avg_product_temp: 0
__________________________ test_rigid_body_with_fluid __________________________
tests/scenarios/test_scenarios.py:311: in test_rigid_body_with_fluid
    result = runner.run_headless(max_steps=100)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/framework/test_framework.py:185: in run_headless
    self.setup()
tests/framework/test_framework.py:136: in setup
    self.scenario.setup(self.sim)
tests/scenarios/rigid_body.py:76: in setup
    sim.add_rigid_body(container_mask, is_static=False)
    ^^^^^^^^^^^^^^^^^^
E   AttributeError: 'GeoGame' object has no attribute 'add_rigid_body'
----------------------------- Captured stdout call -----------------------------

Running scenario: rigid_container_water
Description: Tests rigid GRANITE container with WATER
Parameters: {'grid_size': 60, 'timeout': 30}
------------------------------------------------------------
_________________________ test_rigid_body_displacement _________________________
tests/scenarios/test_scenarios.py:330: in test_rigid_body_displacement
    result = runner.run_headless(max_steps=100)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/framework/test_framework.py:185: in run_headless
    self.setup()
tests/framework/test_framework.py:136: in setup
    self.scenario.setup(self.sim)
tests/scenarios/rigid_body.py:202: in setup
    sim.add_rigid_body(rock_mask, is_static=False)
    ^^^^^^^^^^^^^^^^^^
E   AttributeError: 'GeoGame' object has no attribute 'add_rigid_body'
----------------------------- Captured stdout call -----------------------------

Running scenario: rigid_displacement_granite_in_water
Description: Tests GRANITE rigid body displacing water
Parameters: {'grid_size': 60, 'timeout': 30}
------------------------------------------------------------
_________________________ test_rigid_body_rotation[L] __________________________
tests/scenarios/test_scenarios.py:350: in test_rigid_body_rotation
    result = runner.run_headless(max_steps=50)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/framework/test_framework.py:185: in run_headless
    self.setup()
tests/framework/test_framework.py:136: in setup
    self.scenario.setup(self.sim)
tests/scenarios/rigid_body.py:365: in setup
    body_id = sim.add_rigid_body(shape_mask, is_static=False)
              ^^^^^^^^^^^^^^^^^^
E   AttributeError: 'GeoGame' object has no attribute 'add_rigid_body'
----------------------------- Captured stdout call -----------------------------

Running scenario: rigid_rotation_L_shape
Description: Tests rotation of L-shaped rigid body
Parameters: {'grid_size': 60, 'timeout': 20}
------------------------------------------------------------
_________________________ test_rigid_body_rotation[T] __________________________
tests/scenarios/test_scenarios.py:350: in test_rigid_body_rotation
    result = runner.run_headless(max_steps=50)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/framework/test_framework.py:185: in run_headless
    self.setup()
tests/framework/test_framework.py:136: in setup
    self.scenario.setup(self.sim)
tests/scenarios/rigid_body.py:365: in setup
    body_id = sim.add_rigid_body(shape_mask, is_static=False)
              ^^^^^^^^^^^^^^^^^^
E   AttributeError: 'GeoGame' object has no attribute 'add_rigid_body'
----------------------------- Captured stdout call -----------------------------

Running scenario: rigid_rotation_T_shape
Description: Tests rotation of T-shaped rigid body
Parameters: {'grid_size': 60, 'timeout': 20}
------------------------------------------------------------
____________________________ test_simulation_reset _____________________________
tests/integration/test_simulation_lifecycle.py:92: in test_simulation_reset
    assert np.all(sim.material_types == MaterialType.SPACE), "Materials should reset to space"
E   AssertionError: Materials should reset to space
E   assert np.False_
E    +  where np.False_ = <function all at 0x7b07cdff5770>(array([[<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'...t'>, <MaterialType.BASALT: 'basalt'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.BASALT: 'basalt'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>]],\n      dtype=object) == <MaterialType.SPACE: 'space'>)
E    +    where <function all at 0x7b07cdff5770> = np.all
E    +    and   array([[<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'...t'>, <MaterialType.BASALT: 'basalt'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.BASALT: 'basalt'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.AIR: 'air'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.AIR: 'air'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>],\n       [<MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>,\n        <MaterialType.SPACE: 'space'>, <MaterialType.SPACE: 'space'>]],\n      dtype=object) = <geo_game.GeoGame object at 0x7b07255ec950>.material_types
E    +    and   <MaterialType.SPACE: 'space'> = MaterialType.SPACE
----------------------------- Captured stderr call -----------------------------
Initial pressure distribution:
  Min: 0.0 MPa
  Max: 0.0 MPa
  Mean: 0.0 MPa
  Center: 0.0 MPa
------------------------------ Captured log call -------------------------------
INFO     GeoGame_135270621956432:geo_game.py:161 Initial pressure distribution:
INFO     GeoGame_135270621956432:geo_game.py:162   Min: 0.0 MPa
INFO     GeoGame_135270621956432:geo_game.py:163   Max: 0.0 MPa
INFO     GeoGame_135270621956432:geo_game.py:164   Mean: 0.0 MPa
INFO     GeoGame_135270621956432:geo_game.py:165   Center: 0.0 MPa
___________________________ test_physics_integration ___________________________
tests/integration/test_simulation_lifecycle.py:159: in test_physics_integration
    assert heat_diffused, "Heat diffusion should occur with temperature gradients"
E   AssertionError: Heat diffusion should occur with temperature gradients
E   assert False
=============================== warnings summary ===============================
tests/unit/test_buoyancy_mechanics.py::test_buoyancy_mechanics_basics
  /home/jcdoll/github/personal/geo/.venv/lib/python3.12/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/unit/test_buoyancy_mechanics.py::test_buoyancy_mechanics_basics returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/unit/test_buoyancy_mechanics.py::test_density_based_forces
  /home/jcdoll/github/personal/geo/.venv/lib/python3.12/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/unit/test_buoyancy_mechanics.py::test_density_based_forces returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/unit/test_buoyancy_mechanics.py::test_fluid_displacement_conservation
  /home/jcdoll/github/personal/geo/.venv/lib/python3.12/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/unit/test_buoyancy_mechanics.py::test_fluid_displacement_conservation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/integration/test_simulation_lifecycle.py::test_simulation_reset
  /home/jcdoll/github/personal/geo/material_processes.py:143: RuntimeWarning: overflow encountered in exp
    chemical_enhancement[above_freezing] = np.exp((temps[above_freezing] - 15) / 14.4)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
SKIPPED [1] tests/unit/test_motion_physics.py:26: Group dynamics not available
SKIPPED [1] tests/unit/test_motion_physics.py:121: Group dynamics not available
SKIPPED [1] tests/unit/test_motion_physics.py:216: Group dynamics not available
SKIPPED [1] tests/scenarios/test_scenarios.py:366: Complex fluid interaction test not yet implemented
FAILED tests/unit/test_buoyancy_physics.py::test_buoyancy_direction - Asserti...
FAILED tests/unit/test_fluid_behavior.py::test_fluid_falls_under_gravity - As...
FAILED tests/unit/test_material_cache_cleanup.py::TestMaterialCacheCleanup::test_cache_cleanup_after_delete
FAILED tests/unit/test_poisson_solver.py::TestVelocityProjection::test_velocity_projection_step
FAILED tests/unit/test_pressure_density_gradient.py::TestPressureDensityGradient::test_pressure_gradient_at_interface
FAILED tests/unit/test_pressure_density_gradient.py::TestPressureDensityGradient::test_water_granite_column
FAILED tests/unit/test_pressure_gradient_term.py::test_pressure_gradient_term_added
FAILED tests/unit/test_rigid_body_fall.py::test_rigid_body_fall - AttributeEr...
FAILED tests/unit/test_rigid_body_fluid_container.py::test_rock_donut_with_magma
FAILED tests/unit/test_simple_container_movement.py::test_container_diagnostics
FAILED tests/unit/test_unified_kinematics.py::TestHydrostaticEquilibrium::test_density_stratification
FAILED tests/unit/test_unified_kinematics.py::TestHydrostaticEquilibrium::test_pressure_gradient
FAILED tests/unit/test_unified_kinematics.py::TestPoissonSolver::test_pressure_units
FAILED tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_display_modes
FAILED tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_status_bar_format
FAILED tests/unit/test_visualizer_functionality.py::TestVisualizerFunctionality::test_time_series_data_handling
FAILED tests/scenarios/test_scenarios.py::test_magma_flow_and_cooling - Asser...
FAILED tests/scenarios/test_scenarios.py::test_water_line_collapse - Assertio...
FAILED tests/scenarios/test_scenarios.py::test_fluid_self_gravity - Assertion...
FAILED tests/scenarios/test_scenarios.py::test_gravity_fall[MaterialType.BASALT]
FAILED tests/scenarios/test_scenarios.py::test_gravity_fall[MaterialType.WATER]
FAILED tests/scenarios/test_scenarios.py::test_buoyancy[MaterialType.BASALT-MaterialType.WATER-False]
FAILED tests/scenarios/test_scenarios.py::test_hydrostatic_pressure - Asserti...
FAILED tests/scenarios/test_scenarios.py::test_material_stability[MaterialType.ICE-vacuum-False]
FAILED tests/scenarios/test_scenarios.py::test_rock_metamorphism - AssertionE...
FAILED tests/scenarios/test_scenarios.py::test_phase_transitions[MaterialType.WATER-freezing]
FAILED tests/scenarios/test_scenarios.py::test_rigid_body_with_fluid - Attrib...
FAILED tests/scenarios/test_scenarios.py::test_rigid_body_displacement - Attr...
FAILED tests/scenarios/test_scenarios.py::test_rigid_body_rotation[L] - Attri...
FAILED tests/scenarios/test_scenarios.py::test_rigid_body_rotation[T] - Attri...
FAILED tests/integration/test_simulation_lifecycle.py::test_simulation_reset
FAILED tests/integration/test_simulation_lifecycle.py::test_physics_integration
============ 32 failed, 99 passed, 4 skipped, 4 warnings in 46.76s =============
make: *** [Makefile:5: test] Error 1
